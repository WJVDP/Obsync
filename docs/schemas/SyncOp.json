{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://obsync.local/schemas/SyncOp.json",
  "title": "SyncOp",
  "description": "A single operation submitted by a client device. Markdown updates contain CRDT payloads; binary references contain blob metadata.",
  "type": "object",
  "required": [
    "idempotencyKey",
    "deviceId",
    "path",
    "opType",
    "logicalClock",
    "payload",
    "createdAt"
  ],
  "properties": {
    "idempotencyKey": {
      "type": "string",
      "description": "Unique operation key generated by client for exactly-once ingestion semantics."
    },
    "deviceId": {
      "type": "string",
      "format": "uuid",
      "description": "Originating device identifier."
    },
    "fileId": {
      "type": "string",
      "format": "uuid",
      "description": "Stable file identity if known.",
      "nullable": true
    },
    "path": {
      "type": "string",
      "description": "Current logical path in the vault."
    },
    "opType": {
      "type": "string",
      "enum": ["md_update", "file_create", "file_rename", "file_delete", "blob_ref", "key_rotate"],
      "description": "Operation category."
    },
    "logicalClock": {
      "type": "integer",
      "minimum": 0,
      "description": "Monotonic per-device sequence used for causality tracking on client side."
    },
    "payload": {
      "type": "object",
      "description": "Operation body. For markdown, includes CRDT update payload; for blobs, includes hash/index metadata.",
      "additionalProperties": true
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "Client-side operation creation timestamp in ISO 8601 format."
    }
  },
  "additionalProperties": false
}
